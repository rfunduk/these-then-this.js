<!DOCTYPE html>
<html>
  <head>
    <title>these-then-this.js</title>

    <meta charset="utf-8">
    <meta name="author" content="Ryan Funduk">
    <meta name="description" content="these-then-this.js, a stupid simple async function">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel='stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/skeleton/1.2/skeleton.min.css' type='text/css' charset='utf-8' />
    <link rel="stylesheet" href='//cdnjs.cloudflare.com/ajax/libs/skeleton/1.2/base.min.css' type="text/css" charset='utf-8' />
    <link rel='stylesheet' href='site.css' type='text/css' charset='utf-8' />

    <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js' type='text/javascript'></script>
    <script src='site.js' type='text/javascript'></script>
    <script src='ttt.js' type='text/javascript'></script>
  </head>
  <body>
    <div class='container'>
      <div class='twelve columns offset-by-two'>
        <h1>these-then-this.js</h1>

        <p>
          One day I needed to wait on a couple async requests.
          I could have used:
          <a href='https://github.com/kriskowal/q'>Q</a>,
          <a href='https://github.com/aldonline/syncify'>Syncify.js</a>,
          <a href='https://github.com/caolan/async'>async.js</a>,
          <a href='https://github.com/creationix/step'>Step.js</a>,
          or any number of other solid libraries...
          A dependency for just one tiny back corner of my app :(
        </p>
        <p>
          Instead I wrote ~450 bytes that did the job.
          Here it is (and <a href='https://github.com/rfunduk/these-then-this.js'>on GitHub</a>):
        </p>

        <div class='results' id='ttt'><a href='javascript:void(0);'>done</a></div><pre data-results='ttt' data-src='ttt.js'><code>window.these = function() {
  if( !(this instanceof these) ) { return new these( arguments ); }
  this.functions = Array.prototype.slice.call( arguments[0] );
  this.results = {};
};

these.prototype.thenThis = function( cb ) {
  var instance = this, count = this.functions.length, fn;
  while( fn = this.functions.shift() ) {
    fn( function( key, value ) {
      instance.results[key] = value;
      if( !--count ) { cb( instance.results ); }
    } );
  }
  return this;
};</code></pre>

        <h2>Use It Like This</h2>

        <div class='results' id='example1'><a href='javascript:void(0);'>done</a></div><pre data-results='example1' data-src='example1.js'><code>these(
  function( cb ) {
    cb( 'sync', 'some' + 'sync' + 'work' );
  },
  function( cb ) {
    setTimeout( function() { cb( 'async', 'delayed' ); }, 1000 );
  }
).thenThis( function( results ) {
  alert( JSON.stringify( results, undefined, 2 ) );
} );</code></pre>

        <p>
          You can also check on the progress:
        </p>

        <div class='results' id='example2'><a href='javascript:void(0);'>done</a></div><pre data-results='example2' data-src='example2.js'><code>var those = these(
  function( cb ) { cb( 'quick', 1 ); },
  function( cb ) { setTimeout( function() { cb( 'slow', 2 ); }, 1000 ) }
).thenThis( function( results ) {
  alert( JSON.stringify( results, undefined, 2 ) );
} );

setTimeout( function() {
  alert(
    "quick: " + those.results.quick + ", " + // -> 1
    "slow: " + those.results.slow            // -> undefined
  );
}, 250 );</code></pre>

        <p>
          That is all. This was put together by
          <strong><a href='http://ryanfunduk.com'>Ryan Funduk</a></strong>
          on a humid afternoon.
          <br/>
          Check out my other stuff:
          <a href='https://coursecraft.net'>CourseCraft</a>,
          <a href='https://bugrocket.com'>Bugrocket</a>,
          <a href='http://ryanfunduk.com/jquery-tourbus'>jQuery-TourBus</a>,
          <a href='http://bitbucket.org/rfunduk/mrpassword'>Mr. Password</a>.
        </p>
      </div>
    </div>
  </body>
</html>
